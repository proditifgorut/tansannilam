<script setup lang="ts">
import { ref, watch, computed } from 'vue'
import { X, Banknote, Smartphone } from 'lucide-vue-next'

const props = defineProps({
  modelValue: Boolean,
  type: {
    type: String as () => 'bank_transfer' | 'qris',
    required: true
  }
})

const emit = defineEmits(['update:modelValue', 'select'])

const isOpen = ref(props.modelValue)

watch(() => props.modelValue, (newValue) => {
  isOpen.value = newValue
})

const closeModal = () => {
  emit('update:modelValue', false)
}

const banks = [
  { name: 'BCA', logo: 'https://img-wrapper.vercel.app/image?url=https://upload.wikimedia.org/wikipedia/commons/thumb/5/5c/Bank_Central_Asia_logo.svg/2560px-Bank_Central_Asia_logo.svg.png' },
  { name: 'Mandiri', logo: 'https://img-wrapper.vercel.app/image?url=https://upload.wikimedia.org/wikipedia/commons/thumb/a/ad/Bank_Mandiri_logo_2016.svg/2560px-Bank_Mandiri_logo_2016.svg.png' },
  { name: 'BRI', logo: 'https://img-wrapper.vercel.app/image?url=https://upload.wikimedia.org/wikipedia/commons/thumb/6/68/BANK_BRI_logo.svg/1280px-BANK_BRI_logo.svg.png' },
]

const ewallets = [
  { name: 'GoPay', logo: 'https://img-wrapper.vercel.app/image?url=https://upload.wikimedia.org/wikipedia/commons/thumb/8/86/Gopay_logo.svg/2560px-Gopay_logo.svg.png' },
  { name: 'OVO', logo: 'https://img-wrapper.vercel.app/image?url=https://upload.wikimedia.org/wikipedia/commons/thumb/e/eb/Logo_ovo_purple.svg/1200px-Logo_ovo_purple.svg.png' },
  { name: 'Dana', logo: 'https://img-wrapper.vercel.app/image?url=https://upload.wikimedia.org/wikipedia/commons/thumb/7/72/Logo_dana_blue.svg/2560px-Logo_dana_blue.svg.png' }
]

const selectedBank = ref('')

const selectBank = (bankName: string) => {
  selectedBank.value = bankName
}

const confirmBankSelection = () => {
  if (selectedBank.value) {
    emit('select', { type: 'bank_transfer', detail: selectedBank.value })
    closeModal()
  }
}

const confirmQrisSelection = () => {
  emit('select', { type: 'qris', detail: 'QRIS' })
  closeModal()
}

const title = computed(() => {
  return props.type === 'bank_transfer' ? 'Pilih Bank' : 'Pembayaran E-Wallet'
})

const icon = computed(() => {
  return props.type === 'bank_transfer' ? Banknote : Smartphone
})
</script>

<template>
  <div v-if="isOpen" class="fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center p-4" @click.self="closeModal">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md transform transition-all" :class="isOpen ? 'scale-100 opacity-100' : 'scale-95 opacity-0'">
      <div class="p-6 border-b border-cream-200 flex justify-between items-center">
        <h2 class="text-xl font-semibold text-brown-800 flex items-center">
          <component :is="icon" class="w-6 h-6 mr-3" />
          {{ title }}
        </h2>
        <button @click="closeModal" class="p-2 text-brown-600 hover:text-brown-800">
          <X class="w-6 h-6" />
        </button>
      </div>

      <!-- Bank Transfer Content -->
      <div v-if="type === 'bank_transfer'" class="p-6">
        <p class="text-brown-600 mb-6">Pilih bank tujuan untuk pembayaran melalui Virtual Account.</p>
        <div class="space-y-3">
          <div
            v-for="bank in banks"
            :key="bank.name"
            @click="selectBank(bank.name)"
            :class="['p-4 border-2 rounded-xl flex items-center cursor-pointer transition-all', selectedBank === bank.name ? 'border-orange-500 bg-orange-50' : 'border-cream-300 hover:border-orange-300']"
          >
            <img :src="bank.logo" :alt="bank.name" class="h-6 mr-4 object-contain" />
            <span class="font-semibold text-brown-800">{{ bank.name }} Virtual Account</span>
          </div>
        </div>
        <button @click="confirmBankSelection" :disabled="!selectedBank" class="w-full btn-primary mt-8" :class="{'opacity-50 cursor-not-allowed': !selectedBank}">
          Konfirmasi Pilihan Bank
        </button>
      </div>

      <!-- QRIS Content -->
      <div v-if="type === 'qris'" class="p-6">
        <p class="text-brown-600 mb-6">Anda akan dapat memindai kode QRIS di halaman selanjutnya menggunakan aplikasi e-wallet favorit Anda.</p>
        <div class="flex justify-center items-center space-x-6 bg-cream-50 p-4 rounded-xl">
          <img v-for="ewallet in ewallets" :key="ewallet.name" :src="ewallet.logo" :alt="ewallet.name" class="h-8 object-contain" />
        </div>
        <p class="text-center text-sm text-brown-600 mt-4">Dan aplikasi lain yang mendukung QRIS.</p>
        <button @click="confirmQrisSelection" class="w-full btn-primary mt-8">
          Lanjutkan dengan QRIS
        </button>
      </div>
    </div>
  </div>
</template>
